module Application.HandleKeys where

import Game.Types
import Game.GameData.Tile
import Game.Ghosts.Algo.AStar.Run.Blinky
import Game.Ghosts.Algo.AStar.Run.Pinky
import Game.Ghosts.Algo.AStar.Run.Inky
import Game.Ghosts.Algo.AStar.Run.Clyde
import Game.Ghosts.Algo.AStar.Tiles.Default
import Game.Ghosts.Algo.AStar.Tiles.Definition
import Game.Ghosts.Movement.Blinky
import Game.Ghosts.Movement.Pinky
import Game.Ghosts.Movement.Inky
import Game.Ghosts.Movement.Clyde
import Game.Initial.Level1
import Game.Initial.Level2_4
import Game.Initial.Level5_All
import Game.Pacman.Movement
import Game.Pacman.PacmanCoorToCookieCoor
import Game.Pacman.Tile
import Game.Ghosts.GhostCoorToCookieCoor
import Graphics.Map.Static.Tiles.AllTileData
import Graphics.Map.Static.Tiles.Default
import Graphics.Map.Static.Tiles.Definition
import Graphics.Map.Static.Tiles.TileToCookieCoor

import Graphics.Gloss
import Graphics.Gloss.Interface.IO.Interact
import Data.IORef
import Data.Maybe (isJust,isNothing)
import Data.Sequence as Seq (filter,findIndexL,index,viewl,ViewL(..))


handleKeys :: Event
           -> GameData
           -> IO GameData
handleKeys cevent@(EventKey (SpecialKey KeyUp)    _ _ _) gd = do
  --Get current pacman state.
  pacmancurrentstate <- readIORef $
                        pacmanstate gd
  --Ensure pacman can move in the up direction.
  if | (wallup   $
        walldata $
        pacmancurrenttile pacmancurrentstate) == True
     -> do --Determine if the ghosts need to rerun their astar searches
           --(if the ghosts center coordinates match a tiles center coordinates).
           --Blinky
           blinkycurrentstate <- readIORef $
                                 blinkystate gd
           pinkycurrentstate <- readIORef $
                                pinkystate gd
           inkycurrentstate <- readIORef $
                               inkystate gd
           clydecurrentstate <- readIORef $
                                clydestate gd
           --Get the current tile center coordinates that blinky occupies.
           let blinkycurrentcc = ghostCoorToCookieCoor $
                                 blinkycurrentposition blinkycurrentstate
           let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           if | blinkyincenteroftile
              -> do --Update blinky's state.
                    blinkyastar <- runAStarBlinky gd
                    _ <- writeIORef (blinkystate gd)
                                    blinkyastar
                    --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Update gamestate (InProgress).
                             _ <- writeIORef (gamestate gd)
                                             InProgress
                             return GameData { gamestate       = gamestate gd
                                             , tilestate       = tilestate gd
                                             , currentlevel    = currentlevel gd
                                             , currentscore    = currentscore gd
                                             , pacmanstate     = pacmanstate gd
                                             , blinkystate     = blinkystate gd
                                             , pinkystate      = pinkystate gd
                                             , inkystate       = inkystate gd
                                             , clydestate      = clydestate gd
                                             , doteatentimer   = doteatentimer gd
                                             }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clyde's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
              | otherwise
              -> do --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> return GameData { gamestate       = gamestate gd
                                          , tilestate       = tilestate gd
                                          , currentlevel    = currentlevel gd
                                          , currentscore    = currentscore gd
                                          , pacmanstate     = pacmanstate gd
                                          , blinkystate     = blinkystate gd
                                          , pinkystate      = pinkystate gd
                                          , inkystate       = inkystate gd
                                          , clydestate      = clydestate gd
                                          , doteatentimer   = doteatentimer gd
                                          }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement          
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement 
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clydes's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate     = gamestate gd
                                                      , tilestate     = tilestate gd
                                                      , currentlevel  = currentlevel gd
                                                      , currentscore  = currentscore gd
                                                      , pacmanstate   = pacmanstate gd
                                                      , blinkystate   = blinkystate gd
                                                      , pinkystate    = pinkystate gd
                                                      , inkystate     = inkystate gd
                                                      , clydestate    = clydestate gd
                                                      , doteatentimer = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate  gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
     | otherwise
     -> do --Get current tile state.
           tilecurrentstate <- readIORef $
                               tilestate gd
           --Get current pacman state.
           pacmancurrentstate <- readIORef $
                                 pacmanstate gd
           --Get the current tile center coordinates that pacman occupies.
           let pacmancurrentcc = pacmanCoorToCookieCoor $
                                 pacmancurrentposition pacmancurrentstate
           let pacmanincenteroftile = case Seq.viewl (Seq.filter (\x -> pacmancurrentcc == (centercoordinates $ cookiedata x)) tilecurrentstate) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           let pacmanintilethatcontainscookie = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                                  Seq.EmptyL   -> False
                                                  (x Seq.:< _) -> isJust $ cookietype $ cookiedata x
           --Run through positional possibilities for Pacman.
           if | --Pacman is in the center of a tile AND the tile contains a cookie.
                pacmanincenteroftile &&
                pacmanintilethatcontainscookie
              -> do --Get tile to be updated since pacman just ate a cookie.
                    let tiletobeupdated = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                            Seq.EmptyL   -> defaulttile
                                            (x Seq.:< _) -> x
                    --Update tilestate to reflect the change in the tile (cookie was eaten).
                    let updatedtilestate = updateGameDataTile tiletobeupdated
                                                              tilecurrentstate
                    _ <- writeIORef (tilestate gd)
                                    updatedtilestate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement          
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement 
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is now in the center of a tile AND the tile DOESNT contain a cookie.
                pacmanincenteroftile &&
                (not pacmanintilethatcontainscookie)
              -> do --Update Pacman's position after moving up.
                    let updatedpacmanstatef = updatePacmanMovement cevent
                                                                   pacmancurrentstate
                    --Update Pacman's current tile after moving up.
                    let updatedpacmanstateff = updatePacmanTile tilecurrentstate
                                                                pacmancurrentstate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				-> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement          
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement 
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is not in the center of a tile.
                otherwise
              -> do --Update Pacman's position after moving up.
                    _ <- modifyIORef' (pacmanstate gd)
				      (\x -> updatePacmanMovement cevent
                                                                  x
                                      )
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				 -> do --Update gamestate (InProgress).
                                       _ <- writeIORef (gamestate gd)
                                                       InProgress
                                       return GameData { gamestate       = gamestate gd
                                                    , tilestate       = tilestate gd
                                                    , currentlevel    = currentlevel gd
                                                    , currentscore    = currentscore gd
                                                    , pacmanstate     = pacmanstate gd
                                                    , blinkystate     = blinkystate gd
                                                    , pinkystate      = pinkystate gd
                                                    , inkystate       = inkystate gd
                                                    , clydestate      = clydestate gd
                                                    , doteatentimer   = doteatentimer gd
                                                    }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode  inkycurrentstate)  /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement          
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement 
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
handleKeys cevent@(EventKey (SpecialKey KeyDown)    _ _ _) gd = do
  --Get current pacman state.
  pacmancurrentstate <- readIORef $
                        pacmanstate gd
  --Ensure pacman can move in the down direction.
  if | (walldown $
        walldata $
        pacmancurrenttile pacmancurrentstate) == True
     -> do --Determine if the ghosts need to rerun their astar searches
           --(if the ghosts center coordinates match a tiles center coordinates).
           --Blinky
           blinkycurrentstate <- readIORef $
                                 blinkystate gd
           pinkycurrentstate <- readIORef $
                                pinkystate gd
           inkycurrentstate <- readIORef $
                               inkystate gd
           clydecurrentstate <- readIORef $
                                clydestate gd
           --Get the current tile center coordinates that blinky occupies.
           let blinkycurrentcc = ghostCoorToCookieCoor $
                                 blinkycurrentposition blinkycurrentstate
           let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           if | blinkyincenteroftile
              -> do --Update blinky's state.
                    blinkyastar <- runAStarBlinky gd
                    _ <- writeIORef (blinkystate gd)
                                    blinkyastar
                    --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Update gamestate (InProgress).
                             _ <- writeIORef (gamestate gd)
                                             InProgress
                             return GameData { gamestate       = gamestate gd
                                             , tilestate       = tilestate gd
                                             , currentlevel    = currentlevel gd
                                             , currentscore    = currentscore gd
                                             , pacmanstate     = pacmanstate gd
                                             , blinkystate     = blinkystate gd
                                             , pinkystate      = pinkystate gd
                                             , inkystate       = inkystate gd
                                             , clydestate      = clydestate gd
                                             , doteatentimer   = doteatentimer gd
                                             }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clyde's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
              | otherwise
              -> do --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> return GameData { gamestate       = gamestate gd
                                          , tilestate       = tilestate gd
                                          , currentlevel    = currentlevel gd
                                          , currentscore    = currentscore gd
                                          , pacmanstate     = pacmanstate gd
                                          , blinkystate     = blinkystate gd
                                          , pinkystate      = pinkystate gd
                                          , inkystate       = inkystate gd
                                          , clydestate      = clydestate gd
                                          , doteatentimer   = doteatentimer gd
                                          }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement          
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement 
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clydes's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate     = gamestate gd
                                                      , tilestate     = tilestate gd
                                                      , currentlevel  = currentlevel gd
                                                      , currentscore  = currentscore gd
                                                      , pacmanstate   = pacmanstate gd
                                                      , blinkystate   = blinkystate gd
                                                      , pinkystate    = pinkystate gd
                                                      , inkystate     = inkystate gd
                                                      , clydestate    = clydestate gd
                                                      , doteatentimer = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate  gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
     | otherwise
     -> do --Get current tile state.
           tilecurrentstate <- readIORef $
                               tilestate gd
           --Get current pacman state.
           pacmancurrentstate <- readIORef $
                                 pacmanstate gd
           --Get the current tile center coordinates that pacman occupies.
           let pacmancurrentcc = pacmanCoorToCookieCoor $
                                 pacmancurrentposition pacmancurrentstate
           let pacmanincenteroftile = case Seq.viewl (Seq.filter (\x -> pacmancurrentcc == (centercoordinates $ cookiedata x)) tilecurrentstate) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           let pacmanintilethatcontainscookie = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                                  Seq.EmptyL   -> False
                                                  (x Seq.:< _) -> isJust $ cookietype $ cookiedata x
           --Run through positional possibilities for Pacman.
           if | --Pacman is in the center of a tile AND the tile contains a cookie.
                pacmanincenteroftile &&
                pacmanintilethatcontainscookie
              -> do --Get tile to be updated since pacman just ate a cookie.
                    let tiletobeupdated = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                            Seq.EmptyL   -> defaulttile
                                            (x Seq.:< _) -> x
                    --Update tilestate to reflect the change in the tile (cookie was eaten).
                    let updatedtilestate = updateGameDataTile tiletobeupdated
                                                              tilecurrentstate
                    _ <- writeIORef (tilestate gd)
                                    updatedtilestate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement          
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement 
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is now in the center of a tile AND the tile DOESNT contain a cookie.
                pacmanincenteroftile &&
                (not pacmanintilethatcontainscookie)
              -> do --Update Pacman's position after moving up.
                    let updatedpacmanstatef = updatePacmanMovement cevent
                                                                   pacmancurrentstate
                    --Update Pacman's current tile after moving up.
                    let updatedpacmanstateff = updatePacmanTile tilecurrentstate
                                                                pacmancurrentstate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				-> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement          
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement 
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is not in the center of a tile.
                otherwise
              -> do --Update Pacman's position after moving up.
                    _ <- modifyIORef' (pacmanstate gd)
				      (\x -> updatePacmanMovement cevent
                                                                  x
                                      )
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				 -> do --Update gamestate (InProgress).
                                       _ <- writeIORef (gamestate gd)
                                                       InProgress
                                       return GameData { gamestate       = gamestate gd
                                                    , tilestate       = tilestate gd
                                                    , currentlevel    = currentlevel gd
                                                    , currentscore    = currentscore gd
                                                    , pacmanstate     = pacmanstate gd
                                                    , blinkystate     = blinkystate gd
                                                    , pinkystate      = pinkystate gd
                                                    , inkystate       = inkystate gd
                                                    , clydestate      = clydestate gd
                                                    , doteatentimer   = doteatentimer gd
                                                    }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode  inkycurrentstate)  /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement          
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement 
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
handleKeys cevent@(EventKey (SpecialKey KeyLeft)    _ _ _) gd = do
  --Get current pacman state.
  pacmancurrentstate <- readIORef $
                        pacmanstate gd
  --Ensure pacman can move in the left direction.
  if | (wallleft $
        walldata $
        pacmancurrenttile pacmancurrentstate) == True
     -> do --Determine if the ghosts need to rerun their astar searches
           --(if the ghosts center coordinates match a tiles center coordinates).
           --Blinky
           blinkycurrentstate <- readIORef $
                                 blinkystate gd
           pinkycurrentstate <- readIORef $
                                pinkystate gd
           inkycurrentstate <- readIORef $
                               inkystate gd
           clydecurrentstate <- readIORef $
                                clydestate gd
           --Get the current tile center coordinates that blinky occupies.
           let blinkycurrentcc = ghostCoorToCookieCoor $
                                 blinkycurrentposition blinkycurrentstate
           let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           if | blinkyincenteroftile
              -> do --Update blinky's state.
                    blinkyastar <- runAStarBlinky gd
                    _ <- writeIORef (blinkystate gd)
                                    blinkyastar
                    --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Update gamestate (InProgress).
                             _ <- writeIORef (gamestate gd)
                                             InProgress
                             return GameData { gamestate       = gamestate gd
                                             , tilestate       = tilestate gd
                                             , currentlevel    = currentlevel gd
                                             , currentscore    = currentscore gd
                                             , pacmanstate     = pacmanstate gd
                                             , blinkystate     = blinkystate gd
                                             , pinkystate      = pinkystate gd
                                             , inkystate       = inkystate gd
                                             , clydestate      = clydestate gd
                                             , doteatentimer   = doteatentimer gd
                                             }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clyde's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
              | otherwise
              -> do --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> return GameData { gamestate       = gamestate gd
                                          , tilestate       = tilestate gd
                                          , currentlevel    = currentlevel gd
                                          , currentscore    = currentscore gd
                                          , pacmanstate     = pacmanstate gd
                                          , blinkystate     = blinkystate gd
                                          , pinkystate      = pinkystate gd
                                          , inkystate       = inkystate gd
                                          , clydestate      = clydestate gd
                                          , doteatentimer   = doteatentimer gd
                                          }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clydes's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate     = gamestate gd
                                                      , tilestate     = tilestate gd
                                                      , currentlevel  = currentlevel gd
                                                      , currentscore  = currentscore gd
                                                      , pacmanstate   = pacmanstate gd
                                                      , blinkystate   = blinkystate gd
                                                      , pinkystate    = pinkystate gd
                                                      , inkystate     = inkystate gd
                                                      , clydestate    = clydestate gd
                                                      , doteatentimer = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate  gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
     | otherwise
     -> do --Get current tile state.
           tilecurrentstate <- readIORef $
                               tilestate gd
           --Get current pacman state.
           pacmancurrentstate <- readIORef $
                                 pacmanstate gd
           --Get the current tile center coordinates that pacman occupies.
           let pacmancurrentcc = pacmanCoorToCookieCoor $
                                 pacmancurrentposition pacmancurrentstate
           let pacmanincenteroftile = case Seq.viewl (Seq.filter (\x -> pacmancurrentcc == (centercoordinates $ cookiedata x)) tilecurrentstate) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           let pacmanintilethatcontainscookie = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                                  Seq.EmptyL   -> False
                                                  (x Seq.:< _) -> isJust $ cookietype $ cookiedata x
           --Run through positional possibilities for Pacman.
           if | --Pacman is in the center of a tile AND the tile contains a cookie.
                pacmanincenteroftile &&
                pacmanintilethatcontainscookie
              -> do --Get tile to be updated since pacman just ate a cookie.
                    let tiletobeupdated = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                            Seq.EmptyL   -> defaulttile
                                            (x Seq.:< _) -> x
                    --Update tilestate to reflect the change in the tile (cookie was eaten).
                    let updatedtilestate = updateGameDataTile tiletobeupdated
                                                              tilecurrentstate
                    _ <- writeIORef (tilestate gd)
                                    updatedtilestate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is now in the center of a tile AND the tile DOESNT contain a cookie.
                pacmanincenteroftile &&
                (not pacmanintilethatcontainscookie)
              -> do --Update Pacman's position after moving up.
                    let updatedpacmanstatef = updatePacmanMovement cevent
                                                                   pacmancurrentstate
                    --Update Pacman's current tile after moving up.
                    let updatedpacmanstateff = updatePacmanTile tilecurrentstate
                                                                pacmancurrentstate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				-> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is not in the center of a tile.
                otherwise
              -> do --Update Pacman's position after moving up.
                    _ <- modifyIORef' (pacmanstate gd)
				      (\x -> updatePacmanMovement cevent
                                                                  x
                                      )
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				 -> do --Update gamestate (InProgress).
                                       _ <- writeIORef (gamestate gd)
                                                       InProgress
                                       return GameData { gamestate       = gamestate gd
                                                    , tilestate       = tilestate gd
                                                    , currentlevel    = currentlevel gd
                                                    , currentscore    = currentscore gd
                                                    , pacmanstate     = pacmanstate gd
                                                    , blinkystate     = blinkystate gd
                                                    , pinkystate      = pinkystate gd
                                                    , inkystate       = inkystate gd
                                                    , clydestate      = clydestate gd
                                                    , doteatentimer   = doteatentimer gd
                                                    }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode  inkycurrentstate)  /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
handleKeys cevent@(EventKey (SpecialKey KeyRight)    _ _ _) gd = do
  --Get current pacman state.
  pacmancurrentstate <- readIORef $
                        pacmanstate gd
  --Ensure pacman can move in the right direction.
  if | (wallright $
        walldata  $
        pacmancurrenttile pacmancurrentstate) == True
     -> do --Determine if the ghosts need to rerun their astar searches
           --(if the ghosts center coordinates match a tiles center coordinates).
           --Blinky
           blinkycurrentstate <- readIORef $
                                 blinkystate gd
           pinkycurrentstate <- readIORef $
                                pinkystate gd
           inkycurrentstate <- readIORef $
                               inkystate gd
           clydecurrentstate <- readIORef $
                                clydestate gd
           --Get the current tile center coordinates that blinky occupies.
           let blinkycurrentcc = ghostCoorToCookieCoor $
                                 blinkycurrentposition blinkycurrentstate
           let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           if | blinkyincenteroftile
              -> do --Update blinky's state.
                    blinkyastar <- runAStarBlinky gd
                    _ <- writeIORef (blinkystate gd)
                                    blinkyastar
                    --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Update gamestate (InProgress).
                             _ <- writeIORef (gamestate gd)
                                             InProgress
                             return GameData { gamestate       = gamestate gd
                                             , tilestate       = tilestate gd
                                             , currentlevel    = currentlevel gd
                                             , currentscore    = currentscore gd
                                             , pacmanstate     = pacmanstate gd
                                             , blinkystate     = blinkystate gd
                                             , pinkystate      = pinkystate gd
                                             , inkystate       = inkystate gd
                                             , clydestate      = clydestate gd
                                             , doteatentimer   = doteatentimer gd
                                             }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clyde's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
              | otherwise
              -> do --Update blinky's movement.
                    _ <- modifyIORef' (blinkystate gd)
                                      updateBlinkyMovement
                    --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                    if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> return GameData { gamestate       = gamestate gd
                                          , tilestate       = tilestate gd
                                          , currentlevel    = currentlevel gd
                                          , currentscore    = currentscore gd
                                          , pacmanstate     = pacmanstate gd
                                          , blinkystate     = blinkystate gd
                                          , pinkystate      = pinkystate gd
                                          , inkystate       = inkystate gd
                                          , clydestate      = clydestate gd
                                          , doteatentimer   = doteatentimer gd
                                          }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) == GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                       | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                         (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                         (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                       -> do --Get the current tile center coordinates that pinky occupies.
                             let pinkycurrentcc = ghostCoorToCookieCoor $
                                                  pinkycurrentposition pinkycurrentstate
                             let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             --Get the current tile center coordinates that inky occupies.
                             let inkycurrentcc = ghostCoorToCookieCoor $
                                                 inkycurrentposition inkycurrentstate
                             let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                        Seq.EmptyL   -> False
                                                        (x Seq.:< _) -> True
                             --Get the current tile center coordinates that clyde occupies.
                             let clydecurrentcc = ghostCoorToCookieCoor $
                                                  clydecurrentposition clydecurrentstate
                             let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                         Seq.EmptyL   -> False
                                                         (x Seq.:< _) -> True
                             if | pinkyincenteroftile &&
                                  inkyincenteroftile  &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and inky's state.
                                      pinkyastar <- runAStarPinky gd
                                      inkyastar  <- runAStarInky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's and clyde's state.
                                      pinkyastar <- runAStarPinky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile &&
                                  clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's and clydes's state.
                                      inkyastar  <- runAStarInky gd
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | pinkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's state.
                                      pinkyastar <- runAStarPinky gd
                                      _ <- writeIORef (pinkystate gd)
                                                      pinkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | inkyincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update inky's state.
                                      inkyastar <- runAStarInky gd
                                      _ <- writeIORef (inkystate gd)
                                                      inkyastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | clydeincenteroftile
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update clyde's state.
                                      clydeastar <- runAStarClyde gd
                                      _ <- writeIORef (clydestate gd)
                                                      clydeastar
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate     = gamestate gd
                                                      , tilestate     = tilestate gd
                                                      , currentlevel  = currentlevel gd
                                                      , currentscore  = currentscore gd
                                                      , pacmanstate   = pacmanstate gd
                                                      , blinkystate   = blinkystate gd
                                                      , pinkystate    = pinkystate gd
                                                      , inkystate     = inkystate gd
                                                      , clydestate    = clydestate gd
                                                      , doteatentimer = doteatentimer gd
                                                      }
                                | otherwise
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      --Update pinky's, inky's and clyde's movement.
                                      _ <- modifyIORef' (pinkystate gd)
                                                        updatePinkyMovement
                                      _ <- modifyIORef' (inkystate gd)
                                                        updateInkyMovement
                                      _ <- modifyIORef' (clydestate gd)
                                                        updateClydeMovement
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate  gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
     | otherwise
     -> do --Get current tile state.
           tilecurrentstate <- readIORef $
                               tilestate gd
           --Get current pacman state.
           pacmancurrentstate <- readIORef $
                                 pacmanstate gd
           --Get the current tile center coordinates that pacman occupies.
           let pacmancurrentcc = pacmanCoorToCookieCoor $
                                 pacmancurrentposition pacmancurrentstate
           let pacmanincenteroftile = case Seq.viewl (Seq.filter (\x -> pacmancurrentcc == (centercoordinates $ cookiedata x)) tilecurrentstate) of
                                        Seq.EmptyL   -> False
                                        (x Seq.:< _) -> True
           let pacmanintilethatcontainscookie = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                                  Seq.EmptyL   -> False
                                                  (x Seq.:< _) -> isJust $ cookietype $ cookiedata x
           --Run through positional possibilities for Pacman.
           if | --Pacman is in the center of a tile AND the tile contains a cookie.
                pacmanincenteroftile &&
                pacmanintilethatcontainscookie
              -> do --Get tile to be updated since pacman just ate a cookie.
                    let tiletobeupdated = case Seq.viewl (Seq.filter (\x -> (tilenumber $ pacmancurrenttile pacmancurrentstate) == (tilenumber x)) tilecurrentstate) of
                                            Seq.EmptyL   -> defaulttile
                                            (x Seq.:< _) -> x
                    --Update tilestate to reflect the change in the tile (cookie was eaten).
                    let updatedtilestate = updateGameDataTile tiletobeupdated
                                                              tilecurrentstate
                    _ <- writeIORef (tilestate gd)
                                    updatedtilestate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Update gamestate (InProgress).
                                      _ <- writeIORef (gamestate gd)
                                                      InProgress
                                      return GameData { gamestate       = gamestate gd
                                                      , tilestate       = tilestate gd
                                                      , currentlevel    = currentlevel gd
                                                      , currentscore    = currentscore gd
                                                      , pacmanstate     = pacmanstate gd
                                                      , blinkystate     = blinkystate gd
                                                      , pinkystate      = pinkystate gd
                                                      , inkystate       = inkystate gd
                                                      , clydestate      = clydestate gd
                                                      , doteatentimer   = doteatentimer gd
                                                      }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is now in the center of a tile AND the tile DOESNT contain a cookie.
                pacmanincenteroftile &&
                (not pacmanintilethatcontainscookie)
              -> do --Update Pacman's position after moving up.
                    let updatedpacmanstatef = updatePacmanMovement cevent
                                                                   pacmancurrentstate
                    --Update Pacman's current tile after moving up.
                    let updatedpacmanstateff = updatePacmanTile tilecurrentstate
                                                                pacmancurrentstate
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				-> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
              | --Pacman is not in the center of a tile.
                otherwise
              -> do --Update Pacman's position after moving up.
                    _ <- modifyIORef' (pacmanstate gd)
				      (\x -> updatePacmanMovement cevent
                                                                  x
                                      )
                    --Determine if the ghosts need to rerun their astar searches
                    --(if the ghosts center coordinates match a tiles center coordinates).
                    --Blinky
                    blinkycurrentstate <- readIORef $
                                          blinkystate gd
                    pinkycurrentstate <- readIORef $
                                         pinkystate gd
                    inkycurrentstate <- readIORef $
                                        inkystate gd
                    clydecurrentstate <- readIORef $
                                         clydestate gd
                    --Get the current tile center coordinates that blinky occupies.
                    let blinkycurrentcc = ghostCoorToCookieCoor $
                                          blinkycurrentposition blinkycurrentstate
                    let blinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> blinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                 Seq.EmptyL   -> False
                                                 (x Seq.:< _) -> True
                    if | blinkyincenteroftile
                       -> do --Update blinky's state.
                             blinkyastar <- runAStarBlinky gd
                             _ <- writeIORef (blinkystate gd)
                                             blinkyastar
                             --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
				 -> do --Update gamestate (InProgress).
                                       _ <- writeIORef (gamestate gd)
                                                       InProgress
                                       return GameData { gamestate       = gamestate gd
                                                    , tilestate       = tilestate gd
                                                    , currentlevel    = currentlevel gd
                                                    , currentscore    = currentscore gd
                                                    , pacmanstate     = pacmanstate gd
                                                    , blinkystate     = blinkystate gd
                                                    , pinkystate      = pinkystate gd
                                                    , inkystate       = inkystate gd
                                                    , clydestate      = clydestate gd
                                                    , doteatentimer   = doteatentimer gd
                                                    }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clyde's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
					       _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                       | otherwise
                       -> do --Update blinky's movement.
                             _ <- modifyIORef' (blinkystate gd)
                                               updateBlinkyMovement
                             --See if the other ghosts (Pinky, Inky and Clyde) are still in the ghost house.
                             if | (pinkycurrentmode pinkycurrentstate) == GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> return GameData { gamestate       = gamestate gd
                                                   , tilestate       = tilestate gd
                                                   , currentlevel    = currentlevel gd
                                                   , currentscore    = currentscore gd
                                                   , pacmanstate     = pacmanstate gd
                                                   , blinkystate     = blinkystate gd
                                                   , pinkystate      = pinkystate gd
                                                   , inkystate       = inkystate gd
                                                   , clydestate      = clydestate gd
                                                   , doteatentimer   = doteatentimer gd
                                                   }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   == GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode inkycurrentstate)   /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) == GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's and inky's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                | (pinkycurrentmode pinkycurrentstate) /= GhostHouseStart &&
                                  (inkycurrentmode  inkycurrentstate)  /= GhostHouseStart &&
                                  (clydecurrentmode clydecurrentstate) /= GhostHouseStart
                                -> do --Get the current tile center coordinates that pinky occupies.
                                      let pinkycurrentcc = ghostCoorToCookieCoor $
                                                           pinkycurrentposition pinkycurrentstate
                                      let pinkyincenteroftile = case Seq.viewl (Seq.filter (\x -> pinkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that inky occupies.
                                      let inkycurrentcc = ghostCoorToCookieCoor $
                                                          inkycurrentposition inkycurrentstate
                                      let inkyincenteroftile = case Seq.viewl (Seq.filter (\x -> inkycurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                 Seq.EmptyL   -> False
                                                                 (x Seq.:< _) -> True
                                      --Get the current tile center coordinates that clyde occupies.
                                      let clydecurrentcc = ghostCoorToCookieCoor $
                                                           clydecurrentposition clydecurrentstate
                                      let clydeincenteroftile = case Seq.viewl (Seq.filter (\x -> clydecurrentcc == (centercoordinates $ cookiedata x)) alltiledatainit) of
                                                                  Seq.EmptyL   -> False
                                                                  (x Seq.:< _) -> True
                                      if | pinkyincenteroftile &&
                                           inkyincenteroftile  &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
		                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and inky's state.
                                               pinkyastar <- runAStarPinky gd
                                               inkyastar  <- runAStarInky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's and clyde's state.
                                               pinkyastar <- runAStarPinky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile &&
                                           clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's and clydes's state.
                                               inkyastar  <- runAStarInky gd
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | pinkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's state.
                                               pinkyastar <- runAStarPinky gd
                                               _ <- writeIORef (pinkystate gd)
                                                               pinkyastar
                                               --Update pinky's, inky's and clyde's movement.
                                               _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
                                                                 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | inkyincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update inky's state.
                                               inkyastar <- runAStarInky gd
                                               _ <- writeIORef (inkystate gd)
                                                               inkyastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
                                         | clydeincenteroftile
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update clyde's state.
                                               clydeastar <- runAStarClyde gd
                                               _ <- writeIORef (clydestate gd)
                                                               clydeastar
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate     = gamestate gd
                                                               , tilestate     = tilestate gd
                                                               , currentlevel  = currentlevel gd
                                                               , currentscore  = currentscore gd
                                                               , pacmanstate   = pacmanstate gd
                                                               , blinkystate   = blinkystate gd
                                                               , pinkystate    = pinkystate gd
                                                               , inkystate     = inkystate gd
                                                               , clydestate    = clydestate gd
                                                               , doteatentimer = doteatentimer gd
                                                               }
                                         | otherwise
                                         -> do --Update gamestate (InProgress).
                                               _ <- writeIORef (gamestate gd)
                                                               InProgress
                                               --Update pinky's, inky's and clyde's movement.
					       _ <- modifyIORef' (pinkystate gd)
                                                                 updatePinkyMovement
                                               _ <- modifyIORef' (inkystate gd)
                                                                 updateInkyMovement
                                               _ <- modifyIORef' (clydestate gd)
								 updateClydeMovement
                                               return GameData { gamestate       = gamestate gd
                                                               , tilestate       = tilestate gd
                                                               , currentlevel    = currentlevel gd
                                                               , currentscore    = currentscore gd
                                                               , pacmanstate     = pacmanstate gd
                                                               , blinkystate     = blinkystate  gd
                                                               , pinkystate      = pinkystate gd
                                                               , inkystate       = inkystate gd
                                                               , clydestate      = clydestate gd
                                                               , doteatentimer   = doteatentimer gd
                                                               }
handleKeys _ gd = return gd
